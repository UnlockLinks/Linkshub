<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verify Access</title>

<style>
body{
  margin:0;
  height:100vh;
  background:#020617;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
}
.card{
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(25px);
  border-radius:24px;
  padding:32px;
  width:320px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}
h1{margin:0 0 8px;font-size:1.6rem}
p{font-size:14px;opacity:.7;margin-bottom:24px}
button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:16px;
  font-weight:700;
  font-size:14px;
  cursor:pointer;
}
#start{background:#fff;color:#000}
#continue{
  margin-top:12px;
  background:#aaa;
  color:#000;
  display:none;
}
.loader{
  width:80px;height:80px;
  border:6px solid rgba(255,255,255,.1);
  border-top-color:#3b82f6;
  border-radius:50%;
  margin:0 auto 20px;
  animation:spin 1s linear infinite;
  display:none;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="card">
  <h1>Link Verification</h1>
  <p id="msg">Loading secure linkâ€¦</p>

  <div class="loader" id="loader"></div>

  <button id="start" disabled>START VERIFY</button>
  <button id="continue">CONTINUE</button>
</div>

<script>
/* ================= CONFIG ================= */
const DB = "https://unlocklinks-default-rtdb.firebaseio.com/links/";
const id = location.pathname.replace(/\/$/,'').split('/').pop();

/* ================= ELEMENTS ================= */
const startBtn = document.getElementById("start");
const contBtn  = document.getElementById("continue");
const msg      = document.getElementById("msg");
const loader   = document.getElementById("loader");

/* ================= STATE ================= */
let monetag = "";
let target  = "";

/* ================= HELPERS ================= */
function fixUrl(u){
  if(!u) return "";
  if(/^https?:\/\//i.test(u)) return u;
  return "https://" + u;
}

/* ================= LOAD LINK ================= */
if(!id || id === "Linkshub"){
  msg.textContent = "Invalid link";
}else{
  fetch(DB + id + ".json")
    .then(r=>r.json())
    .then(d=>{
      if(!d) throw 0;
      monetag = fixUrl(d.mc || d.m);
      target  = fixUrl(d.t);
      startBtn.disabled = false;
      msg.textContent = "Click start to verify";
    })
    .catch(()=>{
      msg.textContent = "Link expired or not found";
    });
}

/* ================= START VERIFY ================= */
startBtn.onclick = ()=>{
  if(!monetag) return;

  // ðŸ”¥ ONLY METHOD THAT WORKS
  location.href = monetag;
};

/* ================= CONTINUE ================= */
contBtn.onclick = ()=>{
  if(target) location.href = target;
};

/* ================= RETURN DETECTION ================= */
/* Monetag sends user back â†’ we unlock continue */
window.addEventListener("pageshow",()=>{
  if(monetag){
    loader.style.display = "block";
    msg.textContent = "Verifyingâ€¦";

    setTimeout(()=>{
      loader.style.display = "none";
      contBtn.style.display = "block";
      msg.textContent = "Verification complete";
    },3000);
  }
});
</script>

</body>
</html>
